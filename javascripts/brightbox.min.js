(function(a){jQuery.fn.brightbox=function(p){var r=a.extend({},a.fn.brightbox.defaults,p);var h=a('<div class="brightbox"></div>');var f=a('<div class="brightbox-overlay" />');var o=a('<a title="close" class="brightbox-button brightbox-close" href="#">&times;</a>');var i=a('<a title="next" class="brightbox-button brightbox-next" href="#">&raquo;</a>');var e=a('<a title="previous" class="brightbox-button brightbox-prev" href="#">&laquo;</a>');var c=a('<div class="brightbox-info-box" />');var m=0;var g=this;var d;var k={top:parseInt((a(window).height()-100)/2),left:parseInt((a(window).width()-100)/2),width:100,height:100};if(g.length<1){return null}h.append(o).append(e).append(i).append(c).css(k).appendTo(f);if(r.closeOnOverlayClick){f.bind("click",l)}f.hide();h.hide();a("body").prepend(f).prepend(h);return this.each(function(){a(this).bind("click",s);function s(v){v.preventDefault();var u=a(this).attr("href");var w=a(this).attr("title");for(var t=0;t<g.length;t++){if(u==a(g[t]).attr("href")){m=t;break}}n(u,w);return false}});function l(){if(r.animate){f.fadeOut(r.animationSpeed,s);h.fadeOut(r.animationSpeed)}else{f.hide();h.hide();s()}function s(){h.css(k).hide();a(document).unbind("keyup")}}function b(){if(++m==g.length){m=0}var t=g[m];var s=a(t).attr("href");n(s,a(t).attr("title"))}function j(){if(m==0){m=g.length}m--;var t=g[m];var s=a(t).attr("href");n(s,a(t).attr("title"))}function q(s){s.preventDefault();s.stopPropagation();switch(s.keyCode){case 39:b();break;case 37:j();break;case 27:l();break;default:if(r.closeOnOverlayClick){l()}break}return false}function n(s,u){f.css("opacity","0.9");if(r.animate){f.fadeIn(r.animationSpeed);h.fadeIn(r.animationSpeed)}else{f.show();h.show()}h.find("img").remove();a(document).unbind("keyup");a(document).bind("keyup",q);o.bind("click",function(v){v.preventDefault();v.stopPropagation();l();return false});i.bind("click",function(v){v.preventDefault();v.stopPropagation();if(r.animate){h.find("img").fadeOut(r.animationSpeed,b)}else{h.find("img").show();b()}return false});e.bind("click",function(v){v.preventDefault();v.stopPropagation();if(r.animate){h.find("img").fadeOut(r.animationSpeed,j)}else{h.find("img").show();j()}return false});h.addClass("busy");c.hide();if(r.simulateSlowBandwidth){setTimeout(t,r.simulateSlowBandwidth)}else{t()}function t(){d=new Image();d.src=s;d.onload=function(){h.removeClass("busy");if(d.height>a(window).height()){var w=d.width/d.height;d.height=a(window).height()-50;d.width=d.height*w}a(d).hide().bind("click",function(y){y.preventDefault();y.stopPropagation();if(r.onImageClick){r.onImageClick(s)}return false});var x={top:parseInt((a(window).height()-d.height)/2),left:parseInt((a(window).width()-d.width)/2),width:parseInt(d.width),height:parseInt(d.height)};if(r.animate==true){h.animate(x,r.animationSpeed,v)}else{h.css(x);v()}};function v(){var w=h.find("img");w.remove();h.append(d);if(g.length==1){h.find(".brightbox-prev, .brightbox-next").hide()}c.html(u);u.length>0?c.show():c.hide();h.css({overflow:"visible"});r.animate?a(d).fadeIn():a(d).show()}}}};a.fn.brightbox.defaults={closeOnOverlayClick:true,animate:true,animationSpeed:300,simulateSlowBandwidth:false}})(jQuery);