(function(a){jQuery.fn.brightbox=function(e){var c=a.extend({},a.fn.brightbox.defaults,e);var j=a('<div class="brightbox"></div>');var q=a('<div class="brightbox-overlay" />');var l=a('<a title="close" class="brightbox-button brightbox-close" href="#">&times;</a>');var o=a('<a title="next" class="brightbox-button brightbox-next" href="#">&raquo;</a>');var n=a('<a title="previous" class="brightbox-button brightbox-prev" href="#">&laquo;</a>');var r=a('<div class="brightbox-info-box" />');var p=0;var s=this;var m;var g={top:parseInt((a(window).height()-100)/2),left:parseInt((a(window).width()-100)/2),width:100,height:100};if(s.length<1){return null}j.append(l).append(n).append(o).append(r).css(g).appendTo(q).bind("mousewheel",d);if(c.closeOnOverlayClick){q.bind("click",i)}q.hide();j.hide();a("body").prepend(q).prepend(j);return this.each(function(){a(this).bind("click",t);function t(w){w.preventDefault();var v=a(this).attr("href");var x=a(this).attr("title");for(var u=0;u<s.length;u++){if(v==a(s[u]).attr("href")){p=u;break}}h(v,x);return false}});function i(){if(c.animate){q.fadeOut(c.animationSpeed,t);j.fadeOut(c.animationSpeed)}else{q.hide();j.hide();t()}function t(){j.css(g).hide();a(document).unbind("keyup")}}function k(){if(++p==s.length){p=0}var u=s[p];var t=a(u).attr("href");h(t,a(u).attr("title"))}function f(){if(p==0){p=s.length}p--;var u=s[p];var t=a(u).attr("href");h(t,a(u).attr("title"))}function b(t){t.preventDefault();t.stopPropagation();switch(t.keyCode){case 39:k();break;case 37:f();break;case 27:i();break;default:if(c.closeOnOverlayClick){i()}break}return false}function d(t,u){t.preventDefault();t.stopPropagation();if(s.length>1){if(u>0){k()}else{f()}}return false}function h(t,v){q.css("opacity","0.9");if(c.animate){q.fadeIn(c.animationSpeed);j.fadeIn(c.animationSpeed)}else{q.show();j.show()}j.find("img").remove();a(document).unbind("keyup");a(document).bind("keyup",b);l.bind("click",function(w){w.preventDefault();w.stopPropagation();i();return false});o.bind("click",function(w){w.preventDefault();w.stopPropagation();if(c.animate){j.find("img").fadeOut(c.animationSpeed,k)}else{j.find("img").show();k()}return false});n.bind("click",function(w){w.preventDefault();w.stopPropagation();if(c.animate){j.find("img").fadeOut(c.animationSpeed,f)}else{j.find("img").show();f()}return false});j.addClass("busy");r.hide();if(c.simulateSlowBandwidth){setTimeout(u,c.simulateSlowBandwidth)}else{u()}function u(){m=new Image();m.src=t;m.onload=function(){j.removeClass("busy");var x=m.width/m.height;if(m.height>a(window).height()){m.height=a(window).height()-50;m.width=m.height*x}if(m.width>a(window).width()){m.width=a(window).width();m.height=m.width/x}a(m).hide().bind("click",function(z){z.preventDefault();z.stopPropagation();if(c.onImageClick){c.onImageClick(t)}return false});var y={top:parseInt((a(window).height()-m.height)/2),left:parseInt((a(window).width()-m.width)/2),width:parseInt(m.width),height:parseInt(m.height),};if(c.animate==true){j.animate(y,c.animationSpeed,w)}else{j.css(y);w()}};function w(){var x=j.find("img");x.remove();j.append(m);if(s.length==1){j.find(".brightbox-prev, .brightbox-next").hide()}if(v){r.html(v);v.length>0?r.show():r.hide()}j.css({overflow:"visible"});c.animate?a(m).fadeIn():a(m).show()}}}};a.fn.brightbox.defaults={closeOnOverlayClick:true,animate:true,animationSpeed:300,simulateSlowBandwidth:false}})(jQuery);